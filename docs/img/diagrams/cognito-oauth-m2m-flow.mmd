sequenceDiagram
participant Service as Service A<br/>(Client)
participant Cognito as Cognito<br/>User Pool
participant API as API Gateway<br/>+ Lambda Authorizer
participant Backend as Service B<br/>(Protected Resource)

Service->>Cognito: 1. POST /oauth2/token<br/>grant_type=client_credentials<br/>client_id & client_secret

Cognito->>Cognito: 2. Validate credentials<br/>Check scopes

Cognito->>Service: 3. Return Access Token<br/>JWT with scopes

Service->>API: 4. Request with<br/>Authorization: Bearer {token}

API->>API: 5. Lambda Authorizer<br/>Validate JWT signature<br/>Check scopes & claims

alt Token Valid
    API->>Backend: 6. Forward Request<br/>with user context
    Backend->>Backend: 7. Process Request
    Backend->>API: 8. Response
    API->>Service: 9. Return Response
else Token Invalid
    API->>Service: 401 Unauthorized
end

Note over Service, Cognito: OAuth 2.0 Client Credentials Flow
Note over API, Backend: Scope-based authorization
